<% layout("/layouts/boilerplate") %>

    <section class="show-container">

        <!-- Image -->
        <div class="show-image">
            <img src="<%= listing.image.url  %>" alt="listing image">
            <br>
            <p>owned by: <i><%= listing.owner.username%></i></p>
        </div>

        <!-- Details -->
        <div class="show-details">
            <h1>
                <%= listing.title %>
            </h1>

            <p class="show-location">
                <i class="fa-solid fa-location-dot"></i>
                <%= listing.location %>, <%= listing.country %>
            </p>

            <p class="show-description">
                <%= listing.description %>
            </p>

            <p class="show-price">
                ₹ <%= listing.price %> <span>/ night</span>
            </p>

            <!-- Actions -->
            <% if (currentUser && currentUser._id.toString() === listing.owner._id.toString()) { %>
            <div class="show-actions">
                <a href="/listings/<%= listing._id %>/edit" class="btn-outline">Edit</a>

                <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST"
                    onsubmit="return confirm('Are you sure you want to delete this listing?')">
                    <button class="btn-danger">Delete</button>
                </form>
            </div>
            <% } %>
            
        </div>

        <section class="review-container">

            <h2>Reviews</h2>

            <!-- Add Review Form -->
            <% if (currentUser) { %>
            <form action="/listings/<%= listing._id %>/reviews" method="POST" class="review-form needs-validation"
                novalidate>
                <div class="review-rating">
                    <div class="starability-minimal">
                        <input type="radio" id="star5" name="review[rating]" value="5" required>
                        <label for="star5"></label>

                        <input type="radio" id="star4" name="review[rating]" value="4">
                        <label for="star4"></label>

                        <input type="radio" id="star3" name="review[rating]" value="3">
                        <label for="star3"></label>

                        <input type="radio" id="star2" name="review[rating]" value="2">
                        <label for="star2"></label>

                        <input type="radio" id="star1" name="review[rating]" value="1">
                        <label for="star1"></label>
                    </div>
                </div>


                <label for="comment">Comment</label>
                <textarea name="review[comment]" id="comment" rows="3" required></textarea>

                <button class="btn btn-primary">Submit Review</button>
            </form>
            <% } %>
            <!-- Show Reviews -->
            <% if (listing.reviews && listing.reviews.length> 0) { %>
                <% listing.reviews.forEach(review=> { %>
                    <div class="review-card">
                        <p>@
                            <strong>
                                <%= review.author.username %>
                            </strong>
                        </p>
                        <p><%= "⭐" .repeat(review.rating) %></p>

                        <p>
                            <%= review.comment %>
                        </p>
                        <small>
                            <%= review.created_at.toDateString() %>
                        </small>

                        <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
                            method="POST">
                            <button class="btn-danger btn-small">Delete</button>
                        </form>
                    </div>
                    <% }) %>
                        <% } else { %>
                            <p>No reviews yet.</p>
                            <% } %>
        </section>


    </section>